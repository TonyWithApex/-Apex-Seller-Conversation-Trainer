<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Apex Seller Conversation Trainer â€” Apex Method Edition</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0e0e10;
    --card:#151518;
    --ink:#f4f4f5;
    --muted:#b0b0b8;
    --gold1:#ad9051;
    --gold2:#7c6338;
    --red:#ef4444;
    --green:#10b981;
    --border:#27272a;
    --bubbleSeller:#1f1f22;
    --bubbleYou:#0b84ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:radial-gradient(1200px 800px at 20% -10%, #1b1b20 0%, var(--bg) 55%);
    color:var(--ink);
    font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  }
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  .glass{
    background:rgba(21,21,24,.7);
    border:1px solid var(--border);
    border-radius:18px;
    box-shadow:0 10px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.03);
    overflow:hidden;
  }
  header{
    display:flex;align-items:center;gap:16px;padding:14px 18px;border-bottom:1px solid var(--border);background:linear-gradient(90deg, rgba(173,144,81,.12), transparent);
  }
  .brand{
    display:flex;align-items:center;gap:12px;font-weight:800;letter-spacing:.2px
  }
  .brand img{height:40px;width:40px;object-fit:contain;border-radius:8px;background:#0c0c0e}
  .brand .ttl{font-size:18px;line-height:1.1}
  .badge{
    margin-left:auto;display:flex;align-items:center;gap:12px;
  }
  .pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
  .trust{
    display:flex;align-items:center;gap:8px
  }
  .meter{
    width:160px;height:8px;background:#26262b;border-radius:999px;overflow:hidden;border:1px solid #2e2e34
  }
  .meter > span{display:block;height:100%;background:linear-gradient(90deg, #17cf6a, #f5c84a, #ef4444);width:50%}
  .main{
    display:grid;grid-template-columns:360px 1fr;min-height:72vh
  }
  .side{
    border-right:1px solid var(--border);background:linear-gradient(180deg, rgba(124,99,56,.07), transparent);
    padding:18px
  }
  .sectionTitle{font-weight:700;margin-bottom:12px;color:#e9e9ee}
  .kv{font-size:13px;color:var(--muted);display:grid;gap:8px}
  .kv div{display:flex;justify-content:space-between;gap:8px;padding:10px 12px;background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:10px}
  .stage{margin-top:12px;font-size:12px;color:var(--muted)}
  .content{padding:18px}
  .chat{
    height:60vh;max-height:60vh;overflow:auto;padding:12px;border:1px solid var(--border);
    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.12));
    border-radius:14px
  }
  .row{display:flex;gap:10px;margin:12px 0}
  .bubble{
    padding:10px 14px;border-radius:14px;max-width:70%;
    border:1px solid var(--border);line-height:1.35;font-size:14px
  }
  .seller .bubble{background:var(--bubbleSeller)}
  .you{justify-content:flex-end}
  .you .bubble{background:var(--bubbleYou);border-color:#0b84ff;color:white}
  .name{font-size:11px;color:var(--muted);margin-bottom:6px}
  .choices{display:grid;gap:10px;margin-top:14px}
  .choiceBtn{
    text-align:left;padding:12px 14px;border-radius:12px;border:1px solid var(--border);
    background:#1a1a1f;color:var(--ink);cursor:pointer;font-size:14px;font-weight:600
  }
  .choiceBtn:hover{border-color:#3a3a42;transform:translateY(-1px)}
  .choiceBtn.bad{border-color:#3a2323;background:#211616}
  .system{
    text-align:center;font-size:12px;color:var(--muted);margin:8px 0
  }
  .footerBar{
    display:flex;gap:10px;margin-top:14px;align-items:center;flex-wrap:wrap
  }
  .tag{font-size:12px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;color:var(--muted)}
  .endcard{
    padding:16px;border:1px solid var(--border);border-radius:14px;background:#111113;margin-top:14px
  }
  .dealBtns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  .dealBtn{
    padding:10px 14px;border:1px solid var(--border);border-radius:10px;background:#1b1b20;color:#eaeaf0;cursor:pointer;font-weight:700
  }
  .dealBtn:hover{border-color:#3c3c45}
  .ok{color:var(--green)}
  .no{color:var(--red)}
  .watermark{margin-top:22px;text-align:center;color:#9a9aa2;font-size:12px;opacity:.9}
  /* Login overlay */
  .gate{
    position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:50
  }
  .gateCard{
    width:min(520px,92vw);background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px 18px 18px
  }
  .gateHead{display:flex;align-items:center;gap:12px;margin-bottom:10px}
  .gateHead img{height:44px;width:44px;border-radius:10px;background:#0c0c0e}
  .gateTitle{font-weight:800}
  .input{
    width:100%;padding:12px 14px;border-radius:10px;background:#111114;border:1px solid var(--border);color:var(--ink);font-size:14px
  }
  .btn{padding:10px 14px;border:1px solid var(--border);border-radius:10px;background:linear-gradient(90deg,var(--gold1),var(--gold2));color:#111;cursor:pointer;font-weight:800}
  .err{color:var(--red);font-size:12px;margin-top:8px;min-height:16px}
  @media (max-width:950px){.main{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="glass">
    <header>
      <div class="brand">
        <img src="Shark-T.png" alt="Apex Logo">
        <div class="ttl">Apex Seller Conversation Trainer<br><span style="font-weight:600; font-size:12px; color:#d9d9e0">Apex Method Edition</span></div>
      </div>
      <div class="badge">
        <div class="pill" id="personaPill">Persona: â€”</div>
        <div class="trust">
          <div class="pill">Trust</div>
          <div class="meter"><span id="trustFill" style="width:50%"></span></div>
        </div>
      </div>
    </header>
    <div class="main">
      <aside class="side">
        <div class="sectionTitle">Scenario</div>
        <div class="kv" id="kvPanel"></div>
        <div class="stage">Progress: <span id="stageLabel">Intro</span> â€¢ M C T P</div>
      </aside>
      <section class="content">
        <div class="chat" id="chat"></div>
        <div class="choices" id="choices"></div>
        <div class="footerBar">
          <span class="tag">Apex Gold â€¢ Black</span>
          <span class="tag">MCTP embedded</span>
          <span class="tag" id="runTag">Run #â€”</span>
        </div>
        <div class="watermark">Apex Academy ðŸ¦ˆ</div>
      </section>
    </div>
  </div>
</div>

<!-- Gate -->
<div class="gate" id="gate">
  <div class="gateCard">
    <div class="gateHead">
      <img src="Shark-T.png" alt="Apex">
      <div>
        <div class="gateTitle">Exclusive Access</div>
        <div style="color:#bdbdc6; font-size:13px">Enter the password to train.</div>
      </div>
    </div>
    <div style="display:grid; gap:10px; margin:10px 0 6px">
      <input id="pw" class="input" type="password" placeholder="Password" />
      <button id="go" class="btn">Enter</button>
    </div>
    <div id="err" class="err"></div>
    <div style="margin-top:10px; font-size:12px; color:#a6a6ae">Brand: Apex Method â€¢ Logo file: <b>Shark-T.png</b></div>
  </div>
</div>

<script>
(() => {
  // -------- Utilities
  const $ = sel => document.querySelector(sel);
  const chat = $('#chat'), choices = $('#choices');
  const personaPill = $('#personaPill');
  const trustFill = $('#trustFill');
  const stageLabel = $('#stageLabel');
  const kvPanel = $('#kvPanel');
  const runTag = $('#runTag');

  const pick = arr => arr[Math.floor(Math.random()*arr.length)];
  const coin = p => Math.random() < (p ?? 0.5);
  const clamp = (v,min,max)=> Math.max(min, Math.min(max, v));
  const wait = ms => new Promise(res=>setTimeout(res, ms));

  // -------- Personas (DISC-style flavor)
  const PERSONAS = [
    {id:'Blue',    tone:'warm/rapport-first',   intro:["Hey, Iâ€™m just exploring options and have a few concerns.","Hi thereâ€”curious, but Iâ€™m cautious with this stuff."], objection:["I just want this to feel right.","Iâ€™m nervous about making a mistake."]},
    {id:'Yellow',  tone:'family/community',     intro:["Hi! Iâ€™m weighing whatâ€™s best for my family.","I want to be fairâ€”but also practical for everyone."], objection:["Is this the best outcome for my family?","I donâ€™t want stress for everyone involved."]},
    {id:'Red',     tone:'direct/control',       intro:["You buy houses? Whatâ€™s the catch?","Letâ€™s keep it straight: what do you offer?"], objection:["Another buyer said theyâ€™ll pay more.","I donâ€™t want to waste timeâ€”make it simple."]},
    {id:'Green',   tone:'facts/data',           intro:["Can you explain how this works, cost-wise?","I just want a transparent breakdown."], objection:["Show me the math behind this.","Iâ€™m not convinced without numbers."]},
  ];

  // -------- Dynamic condition responses
  const CONDITION_PACKS = {
    heavy: [
      "Roof is near end-of-life and HVACâ€™s original.",
      "Foundation hairline cracks + HVAC on its last leg.",
      "Roof + plumbing issues that I donâ€™t want to handle."
    ],
    medium: [
      "Mostly cosmeticâ€”paint, floors, dated kitchen.",
      "Some deferred maintenance: minor roof patch + bathroom updates.",
      "Itâ€™s livable, but needs updating to be market ready."
    ],
    light: [
      "No big stuffâ€”maybe paint and a few touch-ups.",
      "Honestly, pretty clean aside from minor wear.",
      "Nothing major Iâ€™m aware of."
    ],
    none: [
      "No known issues.",
      "Everythingâ€™s fine from what I know.",
      "No repairs needed as far as I can tell."
    ]
  };

  // -------- Objection pool (seller triggers)
  const OBJECTIONS = [
    "Another buyer said they might pay more.",
    "Iâ€™m not sure I want a low cash number.",
    "Why not just list with an agent?",
    "Iâ€™m nervous about getting pressured.",
    "I donâ€™t want surprises or hidden costs."
  ];

  // -------- Conversation FSM
  const STAGES = ["intro","safety","expect","discover_M","discover_C","discover_T","discover_P","objection","wrap","dealtype","done"];

  // -------- Scenario generator
  function genScenario(){
    const persona = pick(PERSONAS);

    // Motivations
    const motivations = [
      "Relocating for work soon",
      "Inherited propertyâ€”donâ€™t want to manage it",
      "Downsizing and want less hassle",
      "Landlord tired of repairs/tenants"
    ];
    const M = pick(motivations);

    // Condition severity
    const severityKey = pick(["heavy","medium","light","none"]);
    const C = pick(CONDITION_PACKS[severityKey]);

    // Timeline
    const timelines = [
      {label:"ASAP (â‰¤ 14 days)", speed:"fast"},
      {label:"Soon (30 days)", speed:"fast"},
      {label:"Flexible (30â€“60 days)", speed:"flex"},
      {label:"Not urgent (60+ days)", speed:"slow"}
    ];
    const T = pick(timelines);

    // Price posture
    const prices = [
      {label:"Top-dollar leaning", posture:"high"},
      {label:"Fair tradeoff for ease", posture:"balanced"},
      {label:"Payment-focused over price", posture:"terms"},
      {label:"Underwater / little equity", posture:"lowEquity"}
    ];
    const P = pick(prices);

    // Precompute recommended deal type from signals
    const dealType = inferDealType({severityKey, T, P});
    const sellerName = pick(["Alex","Jordan","Taylor","Morgan","Renee","Chris","Sam","Avery"]);
    const addr = `${Math.floor(Math.random()*900)+100} ${pick(["Maple","Oak","Cedar","Pine","Lake","Hill","Sunset"])} ${pick(["St","Ave","Rd","Blvd"])}`
    const city = pick(["Phoenix, AZ","Las Vegas, NV","Dallas, TX","Tampa, FL","Columbus, OH"]);

    return {
      persona,
      M, C, severityKey, T, P,
      dealType,
      sellerName,
      property:{address:addr, city},
      trustStart: clamp( (persona.id==="Red"? 50: persona.id==="Green"? 55 : 60) + (Math.random()*15-7), 35, 75 )
    }
  }

  function inferDealType({severityKey, T, P}){
    // Simple rules:
    // - CASH: needs speed OR heavy repairs OR wants certainty/ease (balanced) & fast
    // - NOVATION: wants top dollar (high) + medium/light condition + not-fast
    // - SUB2: lowEquity OR payment/terms focus + wants speed/flex; often when rate/loan is good
    // - SELLER FINANCE: payment-focused over price + not urgent
    if (P.posture === "lowEquity") return "Sub2";
    if (P.posture === "terms" && (T.speed==="slow" || T.speed==="flex")) return "Seller Finance";
    if (P.posture === "terms" && (T.speed==="fast")) return "Sub2";
    if (severityKey==="heavy" || T.speed==="fast") return "Cash";
    if (P.posture==="high" && (severityKey==="medium"||severityKey==="light"||severityKey==="none") && T.speed!=="fast") return "Novation";
    // default fallbacks
    if (P.posture==="balanced") return T.speed==="fast" ? "Cash" : "Novation";
    return "Cash";
  }

  // -------- Render helpers
  function sellerSay(txt){ addRow("seller", txt); }
  function youSay(txt){ addRow("you", txt); }
  function sysNote(txt){ const n = document.createElement("div"); n.className="system"; n.textContent = txt; chat.appendChild(n); chat.scrollTop = chat.scrollHeight; }
  function addRow(who, msg){
    const row = document.createElement("div");
    row.className = "row " + (who==="you"?"you":"seller");
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    if (who==="seller"){
      const nm = document.createElement("div"); nm.className="name"; nm.textContent = current.sellerName + " â€¢ Seller";
      bubble.appendChild(nm);
    } else {
      const nm = document.createElement("div"); nm.className="name"; nm.textContent = "You â€¢ Buyer";
      bubble.appendChild(nm);
    }
    const p = document.createElement("div");
    p.textContent = msg;
    bubble.appendChild(p);
    row.appendChild(bubble);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
  }

  function setChoices(options){
    choices.innerHTML = "";
    options.forEach(opt=>{
      const b = document.createElement("button");
      b.className = "choiceBtn";
      b.textContent = opt.label;
      b.addEventListener("click", ()=> opt.onpick());
      choices.appendChild(b);
    });
  }

  function setStage(label){ stageLabel.textContent = label; }

  function setTrust(v){
    state.trust = clamp(v, 0, 100);
    trustFill.style.width = state.trust + "%";
  }

  function refreshKV(){
    kvPanel.innerHTML = `
      <div><span>Seller</span><span>${current.sellerName}</span></div>
      <div><span>Persona</span><span>${current.persona.id}</span></div>
      <div><span>Motivation (M)</span><span>${current.M}</span></div>
      <div><span>Condition (C)</span><span>${current.severityKey}</span></div>
      <div><span>Timeline (T)</span><span>${current.T.label}</span></div>
      <div><span>Price Posture (P)</span><span>${current.P.label}</span></div>
      <div><span>Property</span><span>${current.property.address}</span></div>
      <div><span>Market</span><span>${current.property.city}</span></div>
    `;
    personaPill.textContent = `Persona: ${current.persona.id}`;
  }

  // -------- Flow logic
  let current = null;
  let state = null;
  let runCount = 0;

  function newRun(){
    runCount++;
    runTag.textContent = `Run #${runCount}`;
    chat.innerHTML = ""; choices.innerHTML = "";
    current = genScenario();
    state = {
      stage: "intro",
      trust: current.trustStart,
      mctp: {M:false,C:false,T:false,P:false},
      strikes: 0
    };
    setTrust(state.trust);
    refreshKV();
    intro();
  }

  async function intro(){
    setStage("Intro");
    sellerSay(pick(current.persona.intro));
    await wait(400);
    setChoices([
      {label:"Quick heads up: youâ€™re comfortable saying no if this isnâ€™t a fit, right?", onpick:()=>{ // Safety-first
        youSay("Quick heads up: youâ€™re comfortable saying no if this isnâ€™t a fit, right?");
        correctAdvance(3, "safety");
      }},
      {label:"Iâ€™ll buy if the price is rightâ€”whatâ€™s your lowest number?", onpick:()=>{ youSay("Iâ€™ll buy if the price is rightâ€”whatâ€™s your lowest number?"); wrongRetry(5); }},
      {label:"Cool. If Iâ€™m not the right buyer Iâ€™ll say no too. Fair?", onpick:()=>{ youSay("Cool. If Iâ€™m not the right buyer Iâ€™ll say no too. Fair?"); correctAdvance(3, "safety"); }},
    ]);
  }

  async function safety(){
    setStage("Safety / Rapport");
    sellerSay(pick([
      "Appreciate that. No pressure works for me.",
      "Thanksâ€”that actually makes me feel better.",
      "Goodâ€”just want an honest convo."
    ]));
    await wait(400);
    setChoices([
      {label:"Fair. If we explore this, cash trades speed & certainty for some discount. If that doesnâ€™t help, Iâ€™ll say so.", onpick:()=>{
        youSay("Fair. If we explore this, cash trades speed & certainty for some discount. If that doesnâ€™t help, Iâ€™ll say so.");
        correctAdvance(2,"expect");
      }},
      {label:"Cash is cheaper than listing. Thatâ€™s how it isâ€”okay?", onpick:()=>{
        youSay("Cash is cheaper than listing. Thatâ€™s how it isâ€”okay?");
        wrongRetry(4);
      }},
      {label:"Youâ€™ll need to cooperate if you want an offer.", onpick:()=>{
        youSay("Youâ€™ll need to cooperate if you want an offer.");
        wrongRetry(6);
      }},
    ]);
  }

  async function expect(){
    setStage("Expectation Setting");
    sellerSay(pick([
      "Okayâ€”how is this different from listing with an agent?",
      "Soâ€¦ why pick you over just listing it?",
      "Got it. How does this compare to the MLS route?"
    ]));
    await wait(400);
    setChoices([
      {label:"Cash is lower than list because you skip repairs, showings, and delays. Itâ€™s about ease & certainty. If that tradeoff doesnâ€™t help, Iâ€™ll tell you upfront.", onpick:()=>{
        youSay("Cash is lower than list because you skip repairs, showings, and delays. Itâ€™s about ease & certainty. If that tradeoff doesnâ€™t help, Iâ€™ll tell you upfront.");
        correctAdvance(2,"discover_M");
      }},
      {label:"MLS is a hassle. Just sell to me.", onpick:()=>{
        youSay("MLS is a hassle. Just sell to me.");
        wrongRetry(6);
      }},
      {label:"Weâ€™re cheaper but fasterâ€”end of story.", onpick:()=>{
        youSay("Weâ€™re cheaper but fasterâ€”end of story.");
        wrongRetry(5);
      }},
    ]);
  }

  async function discover_M(){
    setStage("Discover: Motivation (M)");
    sellerSay(pick([
      "Iâ€™m just weighing options.",
      "Still deciding if I should sell.",
      "Iâ€™m exploring what makes sense."
    ]));
    await wait(350);
    setChoices([
      {label:"Whatâ€™s most important right nowâ€”speed, price, or making this easy?", onpick:()=>{
        youSay("Whatâ€™s most important right nowâ€”speed, price, or making this easy?");
        current.mctp = current.mctp || {};
        state.mctp.M = true;
        correctAdvance(2,"discover_C", sellerRespondToM);
      }},
      {label:"Letâ€™s talk numbers only.", onpick:()=>{
        youSay("Letâ€™s talk numbers only.");
        wrongRetry(3);
      }},
      {label:"I just need your bottom line.", onpick:()=>{
        youSay("I just need your bottom line.");
        wrongRetry(4);
      }},
    ]);
  }

  function sellerRespondToM(){
    const pri = {
      fast: ["Speed and certainty matter more than squeezing every dollar.","Iâ€™d prefer a quick, clean exit."],
      flex: ["Honestlyâ€”balance. Not max price, not rock-bottom.","I want fair + low stress."],
      slow: ["Top dollar matters more to me.","Iâ€™m okay waiting if the outcomeâ€™s right."]
    };
    const pickByT = current.T.speed==="fast"? pri.fast : current.T.speed==="slow"? pri.slow : pri.flex;
    sellerSay(pick(pickByT));
  }

  async function discover_C(){
    setStage("Discover: Condition (C)");
    await wait(200);
    sellerSay("There are a few repairs I donâ€™t want to deal with.");
    await wait(200);
    setChoices([
      {label:"Got it. Any major itemsâ€”roof, HVAC, or foundationâ€”we should factor in so youâ€™re not surprised later?", onpick:()=>{
        youSay("Got it. Any major itemsâ€”roof, HVAC, or foundationâ€”we should factor in so youâ€™re not surprised later?");
        // dynamic condition reply by severity
        let pool = CONDITION_PACKS[current.severityKey];
        // spice: for realism, randomly pick explicit short answers sometimes
        const shorts = ["Roof","HVAC","Foundation","No","No major","Just cosmetic"];
        const reply = coin(0.55)? pick(pool) : pick(shorts);
        sellerSay(reply);
        state.mctp.C = true;
        correctAdvance(2,"discover_T");
      }},
      {label:"Tell me whatâ€™s broken so I can lowball you.", onpick:()=>{
        youSay("Tell me whatâ€™s broken so I can lowball you.");
        wrongRetry(7);
      }},
      {label:"Iâ€™ll inspect later. Next question.", onpick:()=>{
        youSay("Iâ€™ll inspect later. Next question.");
        wrongRetry(3);
      }},
    ]);
  }

  async function discover_T(){
    setStage("Discover: Timeline (T)");
    await wait(200);
    sellerSay(pick(["Sooner is better, but Iâ€™m not locked in.","Timing depends on where Iâ€™m moving.","Iâ€™m flexible."]))
    await wait(200);
    setChoices([
      {label:"Is there a date youâ€™d love to be done byâ€”even if it isnâ€™t firm yet?", onpick:()=>{
        youSay("Is there a date youâ€™d love to be done byâ€”even if it isnâ€™t firm yet?");
        sellerSay(pick([
          `If possible, ${ current.T.speed==="fast" ? "within a couple weeks" : current.T.speed==="slow" ? "in a month or two" : "about 30â€“45 days" }.`,
          current.T.label
        ]));
        state.mctp.T = true;
        correctAdvance(2,"discover_P");
      }},
      {label:"We close when I say we close.", onpick:()=>{
        youSay("We close when I say we close.");
        wrongRetry(8);
      }},
      {label:"Letâ€™s skip timeline.", onpick:()=>{
        youSay("Letâ€™s skip timeline.");
        wrongRetry(3);
      }},
    ]);
  }

  async function discover_P(){
    setStage("Discover: Price (P)");
    await wait(200);
    sellerSay("Give me a ballpark.");
    await wait(200);
    setChoices([
      {label:"Just to set expectations: investors in your area have paid in ranges like this when properties need work. Not finalâ€”could be higher/lower based on condition & timing. Fair to proceed?", onpick:()=>{
        youSay("Just to set expectations: investors in your area have paid in ranges like this when properties need work. Not finalâ€”could be higher/lower based on condition & timing. Fair to proceed?");
        sellerSay(pick([
          "Okayâ€”transparency helps.",
          "Thatâ€™s reasonable if itâ€™s straightforward.",
          "Alrightâ€”letâ€™s keep going."
        ]));
        state.mctp.P = true;
        correctAdvance(2,"objection");
      }},
      {label:"Fineâ€”Iâ€™ll toss a number. Take it or leave it.", onpick:()=>{
        youSay("Fineâ€”Iâ€™ll toss a number. Take it or leave it.");
        wrongRetry(8);
      }},
      {label:"Price is price. Not discussing.", onpick:()=>{
        youSay("Price is price. Not discussing.");
        wrongRetry(6);
      }},
    ]);
  }

  async function objection(){
    setStage("Objection Handling");
    await wait(220);
    const obj = pick(OBJECTIONS);
    sellerSay(obj);
    await wait(200);

    // build options aligned with Apex Method
    const ok1 = "Thatâ€™s fair. Youâ€™re always free to pass. Want me to lay out both pathsâ€”cash vs listâ€”so you can decide calmly?";
    const ok2 = "I hear you. Let me show numbers transparently so you stay in controlâ€”no surprises.";
    const bad1 = "Thatâ€™s not realisticâ€”you wonâ€™t get better.";
    const bad2 = "Look, take my offer or I move on.";

    const opts = [
      {label: ok1, good:true},
      {label: ok2, good:true},
      {label: bad1, good:false},
      {label: bad2, good:false},
    ].sort(()=>Math.random()-0.5);

    setChoices(opts.map(o=>({
      label:o.label,
      onpick:()=>{
        youSay(o.label);
        if(o.good){ correctAdvance(3,"wrap"); }
        else{ wrongRetry(8); }
      }
    })));
  }

  async function wrap(){
    setStage("Wrap");
    await wait(220);
    sellerSay(pick([
      "Okay, I appreciate the way youâ€™re handling this.",
      "This has been helpfulâ€”thanks for staying transparent.",
      "Alrightâ€”this is making sense."
    ]));
    await wait(150);
    setChoices([
      {label:"If it helps, I can summarize and weâ€™ll see the cleanest path forward.", onpick:()=>{
        youSay("If it helps, I can summarize and weâ€™ll see the cleanest path forward.");
        correctAdvance(2,"dealtype", showDealTypeQuiz);
      }},
      {label:"Ready to sign now?", onpick:()=>{ youSay("Ready to sign now?"); wrongRetry(6); }},
      {label:"Soâ€¦ are we doing this?", onpick:()=>{ youSay("Soâ€¦ are we doing this?"); wrongRetry(5); }},
    ]);
  }

  function showDealTypeQuiz(){
    setStage("Deal Fit");
    const summary = `Summary: M=${state.mctp.M?'âœ“':'â€”'}, C=${state.mctp.C?'âœ“':'â€”'}, T=${state.mctp.T?'âœ“':'â€”'}, P=${state.mctp.P?'âœ“':'â€”'}.`;
    sysNote(summary);
    const card = document.createElement("div");
    card.className="endcard";
    card.innerHTML = `
      <div style="font-weight:800; margin-bottom:6px">What type of deal is the best initial fit?</div>
      <div style="color:var(--muted); font-size:13px">Pick the offer type the conversation actually points to.</div>
      <div class="dealBtns">
        <button class="dealBtn" data-type="Cash">Cash</button>
        <button class="dealBtn" data-type="Novation">Novation</button>
        <button class="dealBtn" data-type="Sub2">Sub2</button>
        <button class="dealBtn" data-type="Seller Finance">Seller Finance</button>
      </div>
      <div id="dealResult" style="margin-top:10px; font-size:13px"></div>
      <div class="watermark" style="margin-top:12px; opacity:.7">Apex Academy ðŸ¦ˆ</div>
    `;
    choices.innerHTML = "";
    choices.appendChild(card);

    card.querySelectorAll(".dealBtn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const pickType = btn.getAttribute("data-type");
        const out = card.querySelector("#dealResult");
        if(pickType === current.dealType){
          out.innerHTML = `<span class="ok">Correct.</span> Scenario favored <b>${current.dealType}</b>.`;
          state.stage = "done";
          setStage("Complete");
          sysNote("Session complete. Refresh or click Restart to try a new scenario.");
          showRestart();
        } else {
          out.innerHTML = `<span class="no">Not quite.</span> Try again.`;
        }
      });
    });
  }

  function showRestart(){
    const b = document.createElement("button");
    b.className = "btn";
    b.style.marginTop = "10px";
    b.textContent = "Restart with New Seller";
    b.addEventListener("click", newRun);
    choices.appendChild(b);
  }

  // Correct / wrong handling
  function correctAdvance(trustDelta,nextStage,afterFn){
    setTrust(state.trust + trustDelta);
    if (afterFn) afterFn();
    // smooth seller acknowledge occasionally
    if (coin(0.35)) sellerSay(pick([
      "Makes sense.",
      "Alright, thatâ€™s reasonable.",
      "Okay, Iâ€™m following."
    ]));
    state.stage = nextStage;
    // move next stage
    setTimeout(()=>{
      flow[nextStage]();
    }, 350);
  }

  function wrongRetry(penalty=6){
    setTrust(state.trust - penalty);
    sysNote("Not the best move. Try another response.");
    // if trust hits 0, end scenario
    if (state.trust <= 0){
      sellerSay("Iâ€™m not comfortable continuing. Letâ€™s end it here.");
      setStage("Ended");
      showRestart();
      choices.innerHTML = "";
      return;
    }
    // do nothing else; same step remains with options intact (student tries again)
  }

  const flow = {
    intro, safety, expect, discover_M, discover_C, discover_T, discover_P, objection, wrap, dealtype: showDealTypeQuiz, done: ()=>{}
  };

  // -------- Gate
  const gate = $('#gate'), pw = $('#pw'), go = $('#go'), err = $('#err');
  go.addEventListener('click', tryOpen);
  pw.addEventListener('keydown', e=>{ if(e.key==="Enter") tryOpen(); });

  function tryOpen(){
    if (pw.value.trim() === "SellerConvo2025"){
      gate.style.display = "none";
      newRun();
    } else {
      err.textContent = "Incorrect password.";
    }
  }
})();
</script>
</body>
</html>
