<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Apex Seller Conversation Trainer — Apex Method Edition</title>
<style>
  :root{
    --bg:#0d0d0f; --panel:#141417; --ink:#e9e9ee; --muted:#a7a7b3;
    --gold1:#ad9051; --gold2:#7c6338; --good:#34d399; --warn:#f59e0b; --bad:#ef4444;
    --bubble-blue:#0b93f6; --bubble-gray:#e5e5ea; --ink-dark:#111; --ink-blue:#fff;
    --chip:#1e1e24; --line:#26262b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  header{
    background:linear-gradient(90deg,rgba(173,144,81,.15),rgba(124,99,56,.05));
    border:1px solid var(--line);
    padding:14px 16px;border-radius:14px;display:flex;align-items:center;gap:12px
  }
  header img.logo{width:40px;height:40px;object-fit:contain;filter:drop-shadow(0 0 10px rgba(173,144,81,.25))}
  header .title{font-weight:800;letter-spacing:.2px}
  header .sub{color:var(--muted);font-size:12px;margin-top:2px}
  .hud{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .chip{background:var(--chip);border:1px solid var(--line);padding:10px 12px;border-radius:999px;display:flex;align-items:center;gap:8px}
  .pill{padding:3px 8px;border-radius:999px;font-weight:700}
  .pill.good{background:rgba(52,211,153,.15);color:var(--good)}
  .pill.warn{background:rgba(245,158,11,.15);color:var(--warn)}
  .pill.bad{background:rgba(239,68,68,.15);color:var(--bad)}
  .board{margin-top:14px;background:var(--panel);border:1px solid var(--line);border-radius:14px;overflow:hidden}
  .chat{height:56vh;min-height:420px;overflow:auto;padding:16px;display:flex;flex-direction:column;gap:10px}
  .row{display:flex;gap:8px}
  .row.seller{justify-content:flex-start}
  .row.me{justify-content:flex-end}
  .bubble{max-width:72%;padding:10px 12px;border-radius:18px;word-wrap:break-word;white-space:pre-wrap}
  .seller .bubble{background:var(--bubble-gray);color:var(--ink-dark);border-bottom-left-radius:6px}
  .me .bubble{background:var(--bubble-blue);color:var(--ink-blue);border-bottom-right-radius:6px}
  .name{font-size:11px;color:var(--muted);margin:0 4px 4px}
  .footer{border-top:1px solid var(--line);padding:12px;display:grid;gap:10px}
  .opts{display:grid;gap:8px}
  .opt{background:#1a1a21;border:1px solid var(--line);border-radius:12px;padding:10px;cursor:pointer}
  .opt:hover{border-color:var(--gold1);box-shadow:0 0 0 2px rgba(173,144,81,.15) inset}
  .opt small{display:block;color:var(--muted);margin-top:6px}
  .bar{display:flex;align-items:center;gap:10px;justify-content:space-between}
  .bar .left{display:flex;align-items:center;gap:8px}
  .mctp{display:flex;gap:6px;flex-wrap:wrap}
  .mctp .tag{background:#101014;border:1px solid var(--line);padding:6px 8px;border-radius:10px;font-size:12px;color:var(--muted)}
  .mctp .tag.done{border-color:var(--good);color:var(--good);background:rgba(52,211,153,.1)}
  .btn{background:linear-gradient(90deg,var(--gold2),var(--gold1));color:#0d0d0f;border:0;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .muted{color:var(--muted)}
  .sep{height:8px}
  .feedback{font-size:12px;color:var(--muted);padding:0 4px}
  .summary{padding:16px}
  .summary h3{margin:0 0 8px}
  .hr{height:1px;background:var(--line);margin:12px 0}
  /* Password modal */
  .modal{
    position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:50
  }
  .modal .card{
    width:min(560px,92vw);background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:18px
  }
  .field{display:flex;gap:8px;margin-top:10px}
  input[type="password"]{flex:1;background:#101014;border:1px solid var(--line);border-radius:10px;padding:10px;color:var(--ink)}
  .note{font-size:12px;color:var(--muted);margin-top:6px}
  .brandLock{display:flex;align-items:center;gap:10px}
  .brandLock img{width:38px;height:38px;object-fit:contain}
  .badge{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#101014;color:var(--muted)}
  .right{display:flex;align-items:center;gap:8px}
  .hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <img class="logo" src="Shark-T.png" alt="Apex" />
    <div>
      <div class="title">Apex Seller Conversation Trainer — Apex Method Edition</div>
      <div class="sub">Practice buyer-seller conversations using Safety, Moral Duty, Conviction, and No-Harm — with MCTP discipline.</div>
    </div>
  </header>

  <div class="hud">
    <div class="chip">Trust: <span id="trustLabel" class="pill good">5 / 10</span></div>
    <div class="chip">Persona: <strong id="personaLabel">—</strong></div>
    <div class="chip">Tone: <strong id="toneLabel">—</strong></div>
    <div class="chip">Round: <strong id="roundLabel">0/8</strong></div>
  </div>

  <div class="board">
    <div id="chat" class="chat" aria-live="polite"></div>

    <div class="footer">
      <div class="bar">
        <div class="left">
          <strong>Choose your reply</strong>
          <span id="coachHint" class="badge">Coach hints on</span>
        </div>
        <div class="mctp">
          <div id="tagM" class="tag">M</div>
          <div id="tagC" class="tag">C</div>
          <div id="tagT" class="tag">T</div>
          <div id="tagP" class="tag">P</div>
        </div>
      </div>
      <div id="options" class="opts"></div>
      <div id="feedback" class="feedback"></div>
      <div class="bar">
        <div class="left muted">Apex Method: Create Safety • Moral Duty • Internal Conviction • Avoid Harm</div>
        <div class="right">
          <button id="nextBtn" class="btn" disabled>Next</button>
          <button id="restartBtn" class="btn" style="display:none">New Scenario</button>
        </div>
      </div>
    </div>
  </div>

  <div id="summary" class="summary hidden"></div>
</div>

<!-- Password Gate -->
<div id="gate" class="modal">
  <div class="card">
    <div class="brandLock">
      <img src="Shark-T.png" alt="Apex" />
      <div>
        <div class="title">Exclusive access</div>
        <div class="sub">Apex Academy students only</div>
      </div>
    </div>
    <div class="field">
      <input id="pw" type="password" placeholder="Enter password" />
      <button id="unlock" class="btn">Unlock</button>
    </div>
    <div class="note">Password is provided in your student portal. Need help? Contact your instructor.</div>
  </div>
</div>

<script>
/* ------------------------------------------------------------
   Scenario Engine (v6 Teaching Edition)
   ------------------------------------------------------------ */
const state = {
  trust: 5, maxTrust: 10,
  round: 0, maxRounds: 8,
  mctp: {M:false,C:false,T:false,P:false},
  persona:null, tone:null,
  coach:true,
  history: [],
  ended:false
};

// Personas (DISC-like mapping)
const PERSONAS = [
  { id:'blue',  name:'Blue (Relationship)',  style:'Build rapport first; safety > speed',  tones:['warm','curious','guarded'] },
  { id:'yellow',name:'Yellow (Community)',    style:'Family/community impact; harmony',   tones:['optimistic','thoughtful','cautious'] },
  { id:'red',   name:'Red (Decisive)',        style:'Control, clarity, options fast',     tones:['direct','rushed','skeptical'] },
  { id:'green', name:'Green (Analytical)',    style:'Facts, comps, clarity, proofs',      tones:['measured','questioning','systematic'] },
  { id:'neutral',name:'Neutral Blend',        style:'Balanced; mirror and match',         tones:['neutral','open','unsure'] }
];

// Flow steps (kept coherent)
const STEPS = [
  'catch','compare','objection','motivation','condition','timeline','price','close'
];

// Seller utterances per step (randomized pools, coherent phrasing).
const SELLER = {
  catch: [
    "Okay… you buy houses? What’s the catch?",
    "So you’re an investor—how does this really work?",
    "You’re not going to waste my time, right?"
  ],
  compare: [
    "What’s different about you vs listing with an agent?",
    "Why wouldn’t I just list it traditionally?",
    "Convince me—why a cash buyer?"
  ],
  objection: [
    "Another buyer said they might pay more.",
    "I’ve heard cash buyers just lowball.",
    "I don’t want to get pushed into anything."
  ],
  motivation: [
    "Well… I’m just considering options right now.",
    "Honestly, I haven’t decided if I’m selling yet.",
    "I’m on the fence—depends on a few things."
  ],
  condition: [
    "There are a few repairs I don’t want to deal with.",
    "It’s livable but needs some work.",
    "I don’t have the time or money for fixes."
  ],
  timeline: [
    "Timing depends on where I’m moving.",
    "Sooner is better, but I’m not locked in.",
    "I’m flexible, just don’t want it to drag."
  ],
  price: [
    "What range are we talking about here?",
    "So… how much would you offer on something like this?",
    "Give me a ballpark."
  ],
  close: [
    "Okay, what are next steps if we keep going?",
    "If I liked the number, how would this play out?",
    "What would you need from me?"
  ]
};

// Choice builders per step: each returns {text, key, score, flags, coach}
const BUILD = {
  catch: (p)=>[
    {
      text: "No catch. You’re always free to say no. If an offer helps, great—if not, I’ll tell you upfront.",
      key:'safety', score:+1, flags:{}, coach:"✅ Safety: lowers defenses and opens honesty."
    },
    {
      text: "If you want an offer, you’ll need to cooperate.",
      key:'pressure', score:-2, flags:{}, coach:"⚠️ Pressure triggers resistance; avoid harm."
    },
    {
      text: "Happy to explain, but only if you’re serious. Otherwise this isn’t worth my time.",
      key:'dismissive', score:-3, flags:{}, coach:"❌ Dismissive tone kills trust early."
    }
  ],
  compare: (p)=>[
    {
      text: "Cash is usually lower than list price because you skip repairs, showings, and delays. If convenience doesn’t help you, we shouldn’t force it.",
      key:'expectations', score:+1, flags:{}, coach:"✅ Anchoring + Moral Duty (only help right fits)."
    },
    {
      text: "We’re faster—agents take months and cost you more. Simple.",
      key:'overclaim', score:-1, flags:{}, coach:"⚠️ Oversimplified; respect nuance."
    },
    {
      text: "Listing is fine. But most sellers regret it later.",
      key:'fear', score:-2, flags:{}, coach:"❌ Fear-based framing reduces safety."
    }
  ],
  objection: (p)=>[
    {
      text: "Totally reasonable. You’re always free to pass. Want me to lay out both paths—cash vs list—so you can decide calmly?",
      key:'noPressure', score:+1, flags:{}, coach:"✅ Normalize + Safety + Choice frame."
    },
    {
      text: "They’re bluffing. You won’t get more.",
      key:'challenge', score:-2, flags:{}, coach:"❌ Confrontational; erodes authority."
    },
    {
      text: "If you want top dollar, list it. If not, take mine.",
      key:'ultimatum', score:-3, flags:{}, coach:"❌ Ultimatums spike resistance."
    }
  ],
  motivation: (p)=>[
    {
      text: "What’s most important for you—speed, price, or making this as easy as possible?",
      key:'M', score:+1, flags:{M:true}, coach:"✅ Great priority question (M)."
    },
    {
      text: "So… are you serious or not?",
      key:'pressure', score:-2, flags:{}, coach:"❌ Pressure lowers trust."
    },
    {
      text: "If you don’t decide now, opportunities disappear.",
      key:'scarcityPush', score:-2, flags:{}, coach:"⚠️ Forced scarcity harms safety."
    }
  ],
  condition: (p)=>[
    {
      text: "Got it. Any major items—roof, HVAC, foundation—we should factor in so you’re not surprised later?",
      key:'C', score:+1, flags:{C:true}, coach:"✅ Calm, factual (C)."
    },
    {
      text: "Tell me everything that’s broken.",
      key:'blunt', score:-1, flags:{}, coach:"⚠️ Tone matters; soften to keep safety."
    },
    {
      text: "It can’t be that bad—most are fine.",
      key:'minimize', score:-2, flags:{}, coach:"❌ Minimizing breaks rapport."
    }
  ],
  timeline: (p)=>[
    {
      text: "Is there a date you’d love to be done by—even if it’s not firm yet?",
      key:'T', score:+1, flags:{T:true}, coach:"✅ Future pacing + clarity (T)."
    },
    {
      text: "We close in 7 days—take it or leave it.",
      key:'force', score:-2, flags:{}, coach:"❌ Control without consent = resistance."
    },
    {
      text: "Just tell me when. I don’t care why.",
      key:'cold', score:-2, flags:{}, coach:"❌ Drops safety and empathy."
    }
  ],
  price: (p)=>[
    {
      text: "To set expectations, similar homes sell to investors around a fair range depending on condition. After we confirm details, I’ll show you a transparent breakdown.",
      key:'P', score:+1, flags:{P:true}, coach:"✅ Anchoring setup without hard number (P)."
    },
    {
      text: "What’s your rock-bottom number?",
      key:'lowball', score:-2, flags:{}, coach:"❌ Feels predatory; harms trust."
    },
    {
      text: "Give me a price and I’ll beat it.",
      key:'bid', score:-1, flags:{}, coach:"⚠️ Competes on price only; weak frame."
    }
  ],
  close: (p)=>[
    {
      text: "If it helps, we can outline both paths in writing (cash vs list), then I’ll give a clear offer. You’re comfortable saying no if it’s not right—fair?",
      key:'closeSafety', score:+1, flags:{}, coach:"✅ Safety + micro-commitment + clarity."
    },
    {
      text: "Great, let’s sign today.",
      key:'rush', score:-2, flags:{}, coach:"❌ Rush triggers pushback."
    },
    {
      text: "If you don’t commit now, I’m moving on.",
      key:'threat', score:-3, flags:{}, coach:"❌ Threats destroy trust."
    }
  ]
};

// Persona-sensitive scoring tweaks
function adjustForPersona(choice, personaId){
  let delta = 0;
  if(personaId==='red'){
    if(choice.key==='closeSafety' || choice.key==='T') delta += 1; // clarity/options
    if(choice.key==='pressure' || choice.key==='rush' || choice.key==='threat') delta -= 1; // still penalize pressure
  }
  if(personaId==='blue'){
    if(choice.key==='safety' || choice.key==='noPressure') delta += 1;
    if(choice.key==='blunt' || choice.key==='cold') delta -= 1;
  }
  if(personaId==='green'){
    if(choice.key==='C' || choice.key==='P') delta += 1; // facts/structure
    if(choice.key==='overclaim' || choice.key==='fear') delta -= 1;
  }
  if(personaId==='yellow'){
    if(choice.key==='noPressure' || choice.key==='safety') delta += 1;
    if(choice.key==='challenge' || choice.key==='ultimatum') delta -= 1;
  }
  return delta;
}

// Helpers
const $ = s=>document.querySelector(s);
function tag(v,el){el.classList.toggle('done',!!v)}
function trustBadge(){
  const t = state.trust;
  const el = $('#trustLabel');
  el.textContent = `${Math.max(0,Math.min(state.maxTrust,t))} / ${state.maxTrust}`;
  el.classList.remove('good','warn','bad');
  el.classList.add(t>=7?'good':(t>=4?'warn':'bad'));
}
function setRound(i){ $('#roundLabel').textContent = `${i}/${state.maxRounds}`; }
function scrollChat(){ const c = $('#chat'); c.scrollTop = c.scrollHeight; }

// Chat rendering
function pushSeller(text){ addRow('Seller',text,'seller'); }
function pushMe(text){ addRow('You',text,'me'); }
function addRow(name,text,who){
  const chat = $('#chat');
  const nameEl = document.createElement('div'); nameEl.className='name'; nameEl.textContent = name;
  const row = document.createElement('div'); row.className = `row ${who}`;
  const bubble = document.createElement('div'); bubble.className='bubble'; bubble.textContent = text;
  row.appendChild(bubble);
  chat.appendChild(nameEl); chat.appendChild(row);
  scrollChat();
}

// Step engine
let stepIndex = 0;
function nextStep(){
  if(state.ended) return;
  state.round++;
  setRound(state.round);
  const step = STEPS[stepIndex];
  // seller speaks
  const sPool = SELLER[step];
  pushSeller( sPool[Math.floor(Math.random()*sPool.length)] );
  // options
  const builder = BUILD[step];
  const opts = builder(state.persona);
  renderOptions(opts, step);
  // advance pointer
  stepIndex++;
}

function renderOptions(opts, step){
  const wrap = $('#options'); wrap.innerHTML='';
  $('#feedback').textContent='';
  $('#nextBtn').disabled = true;
  opts.forEach((o,i)=>{
    const div = document.createElement('div');
    div.className='opt';
    div.innerHTML = `<div>${o.text}</div>${state.coach?`<small>${o.coach}</small>`:''}`;
    div.addEventListener('click',()=>onChoice(o, step));
    wrap.appendChild(div);
  });
}

function onChoice(o, step){
  // show my line
  pushMe(o.text);
  // score with persona adjustment
  let score = o.score + adjustForPersona(o, state.persona.id);
  state.trust = Math.max(0, Math.min(state.maxTrust, state.trust + score));
  trustBadge();

  // mark MCTP flags if any
  if(o.flags){
    if(o.flags.M) state.mctp.M = true;
    if(o.flags.C) state.mctp.C = true;
    if(o.flags.T) state.mctp.T = true;
    if(o.flags.P) state.mctp.P = true;
  }
  tag(state.mctp.M,$('#tagM'));
  tag(state.mctp.C,$('#tagC'));
  tag(state.mctp.T,$('#tagT'));
  tag(state.mctp.P,$('#tagP'));

  // feedback line tied to Apex Method
  const fb = $('#feedback');
  let msg = '';
  if(score>0) msg = "Nice. You created safety and guided with conviction.";
  else if(score===0) msg = "Neutral response. Consider reinforcing safety or clarity.";
  else if(score<0 && score>-3) msg = "Careful—tone shaved trust. Reframe with permission and options.";
  else msg = "That triggered resistance. Reset safety and offer a choice frame.";
  fb.textContent = msg;

  // prepare next or end
  $('#options').innerHTML='';
  const terminal = stepIndex >= STEPS.length;
  if(terminal || state.round>=state.maxRounds || state.trust<=0){
    endSession();
  } else {
    $('#nextBtn').disabled = false;
  }
}

function endSession(){
  state.ended = true;
  $('#nextBtn').style.display='none';
  $('#restartBtn').style.display='';
  const got = Object.values(state.mctp).filter(Boolean).length;
  let evalLine = '';
  if(state.trust<=0) evalLine = "Trust collapsed. The seller disengaged. Lead with safety and permission earlier.";
  else if(got>=3 && state.trust>=7) evalLine = "Strong! You earned trust and hit core MCTP. Your framing matched the persona.";
  else if(got>=2) evalLine = "Decent structure. Add clearer permission and choose questions that reveal missing MCTP.";
  else evalLine = "You need more discovery. Ask priority, condition, timeline, and anchor expectations earlier.";

  const sum = $('#summary');
  sum.classList.remove('hidden');
  sum.innerHTML = `
    <h3>Session summary</h3>
    <div class="hr"></div>
    <p><strong>Persona:</strong> ${state.persona.name} <span class="muted">(${state.tone})</span></p>
    <p><strong>Trust:</strong> ${state.trust}/${state.maxTrust}</p>
    <p><strong>MCTP captured:</strong>
      <span class="${state.mctp.M?'pill good':'pill bad'}">M</span>
      <span class="${state.mctp.C?'pill good':'pill bad'}">C</span>
      <span class="${state.mctp.T?'pill good':'pill bad'}">T</span>
      <span class="${state.mctp.P?'pill good':'pill bad'}">P</span>
      <span class="muted">(${Object.values(state.mctp).filter(Boolean).length}/4)</span>
    </p>
    <div class="hr"></div>
    <p>${evalLine}</p>
    <p class="muted">Apex Method: Create Safety • Moral Duty • Internal Conviction • Avoid Harm.</p>
  `;
}

// Scenario init
function seedScenario(){
  // reset UI/state
  $('#summary').classList.add('hidden'); $('#summary').innerHTML='';
  $('#nextBtn').style.display=''; $('#restartBtn').style.display='none';
  $('#nextBtn').disabled=true; $('#feedback').textContent='';
  $('#options').innerHTML=''; $('#chat').innerHTML='';
  state.trust = 5; trustBadge();
  state.round = 0; setRound(0);
  state.mctp = {M:false,C:false,T:false,P:false};
  tag(false,$('#tagM')); tag(false,$('#tagC')); tag(false,$('#tagT')); tag(false,$('#tagP'));
  state.ended=false; stepIndex=0;

  // persona + tone
  const persona = PERSONAS[Math.floor(Math.random()*PERSONAS.length)];
  const tone = persona.tones[Math.floor(Math.random()*persona.tones.length)];
  state.persona = persona; state.tone = tone;
  $('#personaLabel').textContent = persona.name;
  $('#toneLabel').textContent = tone;

  // Opening line (persona-flavored)
  const opens = {
    red: "Let’s keep this straightforward. How do you work?",
    blue: "Hey—happy to chat. I just want this to feel easy.",
    green:"I’ll need clear details before deciding.",
    yellow:"I want this to be smooth for everyone involved.",
    neutral:"Okay, I’m listening. How does this go?"
  };
  pushSeller(opens[persona.id] || opens.neutral);

  // start first step after a beat
  setTimeout(nextStep, 400);
}

// Controls
$('#nextBtn').addEventListener('click', ()=>{
  $('#nextBtn').disabled=true;
  setTimeout(nextStep, 250);
});
$('#restartBtn').addEventListener('click', seedScenario);

// Password gate
const PW = "SellerConvo2025";
$('#unlock').addEventListener('click', ()=>{
  const v = $('#pw').value.trim();
  if(v === PW){
    $('#gate').style.display='none';
    seedScenario();
  } else {
    $('#pw').value='';
    alert('Incorrect password.');
  }
});
$('#pw').addEventListener('keydown',(e)=>{ if(e.key==='Enter') $('#unlock').click(); });
</script>
</body>
</html>
